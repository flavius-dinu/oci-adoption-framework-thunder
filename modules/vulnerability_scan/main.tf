// Copyright (c) 2021, Oracle and/or its affiliates. All rights reserved.
// Licensed under the Universal Permissive License v 1.0 as shown at https://oss.oracle.com/licenses/upl.

resource "oci_vulnerability_scanning_host_scan_recipe" "this" {
  for_each       = var.scan_recipes_params
  compartment_id = var.compartments[each.value.comp_name]
  display_name   = each.value.display_name
  agent_settings {
    scan_level = each.value.scan_level
    agent_configuration {
      vendor = each.value.agent_config_vendor
      cis_benchmark_settings {
        scan_level = each.value.cis_bench_scan_level
      }
    }
  }
  port_settings {
    scan_level = each.value.port_scan_level
  }
  schedule {
    type        = each.value.schedule_type
    day_of_week = each.value.day_of_week
  }

}


resource "oci_vulnerability_scanning_host_scan_target" "this" {
  for_each              = var.scan_target_params
  compartment_id        = var.compartments[each.value.comp_name]
  host_scan_recipe_id   = oci_vulnerability_scanning_host_scan_recipe.this[each.value.recipe_name].id
  target_compartment_id = var.compartments[each.value.target_comp_name]
  display_name          = each.value.display_name
}
